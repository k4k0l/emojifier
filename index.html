<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Emoji Pixel Art</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 0;
    padding: 20px;
  }
  canvas, video {
    display: none;
  }
  #emojiCanvas {
    font-size: 12px;
    line-height: 1;
    display: inline-block;
  }
</style>
</head>
<body>
<h1>Emoji Pixel Art</h1>
<input type="file" id="imageInput" accept="image/*" />
<button id="startCamera">Use Webcam</button>
<button id="capture" style="display:none">Capture</button>
<video id="video" autoplay></video>
<br /><br />
<div id="emojiCanvas"></div>
<canvas id="hiddenCanvas"></canvas>
<script>
const EMOJI_SIZE = 12; // size of emoji characters in pixels

const colorEmojis = [
  { emoji: 'â¬›', color: [0, 0, 0] },
  { emoji: 'â¬œ', color: [255, 255, 255] },
  { emoji: 'ðŸŸ¥', color: [210, 24, 30] },
  { emoji: 'ðŸŸ§', color: [255, 165, 0] },
  { emoji: 'ðŸŸ¨', color: [255, 255, 0] },
  { emoji: 'ðŸŸ©', color: [0, 128, 0] },
  { emoji: 'ðŸŸ¦', color: [0, 0, 255] },
  { emoji: 'ðŸŸª', color: [128, 0, 128] },
  { emoji: 'ðŸŸ«', color: [165, 42, 42] },
  { emoji: 'ðŸ”´', color: [255, 0, 0] },
  { emoji: 'ðŸŸ ', color: [255, 140, 0] },
  { emoji: 'ðŸŸ¡', color: [255, 215, 0] },
  { emoji: 'ðŸŸ¢', color: [0, 255, 0] },
  { emoji: 'ðŸ”µ', color: [0, 0, 255] },
  { emoji: 'ðŸŸ£', color: [186, 85, 211] },
  { emoji: 'ðŸŸ¤', color: [150, 75, 0] }
];

const video = document.getElementById('video');
const imageInput = document.getElementById('imageInput');
const startCamera = document.getElementById('startCamera');
const captureBtn = document.getElementById('capture');
const emojiDiv = document.getElementById('emojiCanvas');
const hiddenCanvas = document.getElementById('hiddenCanvas');
const ctx = hiddenCanvas.getContext('2d');

startCamera.addEventListener('click', async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    video.srcObject = stream;
    video.style.display = 'block';
    captureBtn.style.display = 'inline-block';
  } catch (e) {
    alert('Unable to access camera');
  }
});

captureBtn.addEventListener('click', () => {
  hiddenCanvas.width = video.videoWidth;
  hiddenCanvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  processCanvas();
});

imageInput.addEventListener('change', async event => {
  const file = event.target.files[0];
  if (!file) return;
  const img = new Image();
  img.src = URL.createObjectURL(file);
  await img.decode();
  hiddenCanvas.width = img.width;
  hiddenCanvas.height = img.height;
  ctx.drawImage(img, 0, 0);
  processCanvas();
});

function getAverageColor(sx, sy, size) {
  const data = ctx.getImageData(sx, sy, size, size).data;
  let r = 0,
    g = 0,
    b = 0;
  for (let i = 0; i < data.length; i += 4) {
    r += data[i];
    g += data[i + 1];
    b += data[i + 2];
  }
  const count = data.length / 4;
  return [Math.round(r / count), Math.round(g / count), Math.round(b / count)];
}

function getClosestEmoji(color) {
  let best = colorEmojis[0].emoji;
  let bestDist = Infinity;
  for (const { emoji, color: c } of colorEmojis) {
    const dist =
      (color[0] - c[0]) ** 2 +
      (color[1] - c[1]) ** 2 +
      (color[2] - c[2]) ** 2;
    if (dist < bestDist) {
      bestDist = dist;
      best = emoji;
    }
  }
  return best;
}

function processCanvas() {
  emojiDiv.innerHTML = '';
  const numX = Math.floor(window.innerWidth / EMOJI_SIZE);
  const cellSize = hiddenCanvas.width / numX;
  const numY = Math.ceil(hiddenCanvas.height / cellSize);
  emojiDiv.style.fontSize = EMOJI_SIZE + 'px';

  for (let y = 0; y < numY; y++) {
    const line = document.createElement('div');
    for (let x = 0; x < numX; x++) {
      const sx = Math.floor(x * cellSize);
      const sy = Math.floor(y * cellSize);
      const color = getAverageColor(sx, sy, Math.ceil(cellSize));
      const emoji = getClosestEmoji(color);
      const span = document.createElement('span');
      span.textContent = emoji;
      line.appendChild(span);
    }
    emojiDiv.appendChild(line);
  }
}
</script>
</body>
</html>
